<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Planificateur SCR</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    select, button { margin: 10px 0; padding: 5px; }
    li { margin-bottom: 10px; }
    .intermediate { font-style: italic; font-size: 0.9em; }
  </style>
</head>
<body>

<h2>Planificateur d'itinéraires (max 4 correspondances)</h2>

<label for="start">Départ :</label>
<select id="start"><option value="">-- Choisir --</option></select>

<label for="end">Arrivée :</label>
<select id="end"><option value="">-- Choisir --</option></select>

<button id="searchBtn">Chercher itinéraires</button>

<h3>Résultats :</h3>
<ul id="results"></ul>

<script>

  
const routes = [{"routeId":"R001","type":"Connect","stops":["Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Central"]},
  {"routeId":"R002","type":"Metro","stops":["Stepford Central","Four Ways","Stepford East","Stepford High Street","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton"]},
  {"routeId":"R003","type":"Connect","stops":["Stepford Central","Stepford East","St Helens Bridge","Angel Pass","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},
  {"routeId":"R004","type":"Connect","stops":["St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead"]},
  {"routeId":"R005","type":"Connect","stops":["Stepford Victoria","Financial Quarter","Stepford Central","Stepford East","Saint Helen's Bridge","Bodin","Coxly","Benton","Benton Bridge","Stepford Airport Parkway","Stepford Airport Central"]},
  {"routeId":"R006","type":"Metro","stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton"]},
  {"routeId":"R007","type":"Connect","stops":["Stepford Central","Stepford East","Saint Helen's Bridge","Elsemere Junction","Berrily","Morganstown"]},
  {"routeId":"R008","type":"Metro","stops":["Stepford Victoria","Financial Quarter","City Hoqpital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily"]},
  {"routeId":"R009","type":"Connect","stops":["Stepford Victoria","Stepford Central","Stepford East","Saint Helen's Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Eadgemead"]},
  {"routeId":"R010","type":"Waterline","stops":["Greenslade","Whitney Green","Morganstown Docks","Port Benton","Benton","West Benton","Faraday Road","Eden Quay","Newry"]},
  {"routeId":"R011","type":"Waterline","stops":["Connoly","Ashlan Park","Cambridge Street Parkway","Benton","West Benton","Faraday Road","Eden Quay","Newry"]},
  {"routeId":"R012","type":"Waterline","stops":["Connoly","Ashlan Park","Cambridge Street Parkway","Benton","West Benton","Faraday Road","Eden Quay","Newry","Newry Harbour"]},
  {"routeId":"R013","type":"Waterline","stops":["Greenslade","Whitney Green","Morganstown Docks","Port Benton","Benton"]},
  {"routeId":"R014","type":"Waterline","stops":["Esterfield","Farleigh","Airport West","Cambridge Street Parkway","Benton","West Benton","Faraday Road","Eden Quay","Newry"]},
  {"routeId":"R015","type":"Waterline","stops":["Morganstown","Morganstown Docks","Port Benton","Benton"]},
  {"routeId":"R016","type":"Waterline","stops":["Esterfield","Rosedale Village","Farleigh","James Street","Airport West","Cambridge Street Parkway","Benton"]},
  {"routeId":"R017","type":"Waterline","stops":["Terminal 2","Airport West","Cambridge Street Parkway","Benton","West Benton","Faraday Road","Eden Quay","Newry"]},
  {"routeId":"R018","type":"Waterline","stops":["Farleigh","James Street","Airport West","Cambridge Street Parkway","Benton","West Benton","Faraday Road","Eden Quay","Newry","Newry Harbour"]},
  {"routeId":"R019","type":"Waterline","stops":["Connoly","Ashlan Park","Cambridge Street Parkway","Benton"]},
  {"routeId":"R020","type":"Connect","stops":["Whitefield","Houghton Rake","Woodhead Lane","Stepford United Football Club","Stepford East","Stepford Central"]},
  {"routeId":"R021","type":"Metro","stops":["Stepford Central","Four Ways","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},
  {"routeId":"R022","type":"Connect","stops":["Beechley","Stepford Central","Stepford East","Stepford United Football Club","Woodhead Lane","Houghton Rake","Whitefield"]},
  {"routeId":"R023","type":"Metro","stops":["Stepford Victoria","Financial Quarter","city Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},
  {"routeId":"R024","type":"Connect","stops":["Stepford Central","Stepford East","Saint helen's Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Edgemead","Fayemere","Westercoast","Milcastle","Westwyvern","Starrylock","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R025","type":"Connect","stops":["St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Eadgmead","Fayemere","Westercoast","Milcastle Racecourse","Milcastle","Westwyvern"]},
  {"routeId":"R026","type":"Connect","stops":["Stepford Victoria","Stepford Central","Stepford East","Saint helen's Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Milcastle","Westwyvern","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R027","type":"Metro","stops":["Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily"]},
  {"routeId":"R028","type":"Metro","stops":["Willowfield","Hedmon Park","Beechley","Financial Quartier","Stepford","Stepford Victoria"]},
  {"routeId":"R029","type":"Metro","stops":["Stepford Victoria","Financial Quarter","Beechley"]},
  {"routeId":"R030","type":"Metro","stops":["Willowfield","Hedmon Park","Beechley","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily"]},
  {"routeId":"R031","type":"Metro","stops":["Willowfield","Hedmon Park","Beechley","City Hoqpital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Whitefield Lido","Stepford United Football Club"]},
  {"routeId":"R032","type":"Connect","stops":["Willowfield","Beechley","Stepford Central","Stepford East","Saint Helen's Bridge","Bodin","Coxly","Benton","Port Benton"]},
  {"routeId":"R033","type":"Metro","stops":["Beechley","Stepford Central","Stepford East","Saint Helen's Bridge","Bodin","Coxly","Benton","Benton Bridge","Airport Parway","Airport Central"]},
  {"routeId":"R034","type":"Metro","stops":["Beechley","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily","East Berrily","Beaulieu Park","Morganstown"]},
  {"routeId":"R035","type":"Connect","stops":["Willowfield","Beechley","Stepford Central","Stepford East","St Helens Bridge","Bodin","Coxly","Benton","Benton Bridge","Hampton Hargate","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Eadgmead","Fayemere","Westercoast","Milcastle","Westwyvern"]},
  {"routeId":"R036","type":"Connect","stops":["Willowfield","Beechley","Stepford Central","Stepford East","Saint helen's Bridge","Bodin","Coxly","Benton","Hampton Hargate","Water Newton","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Milcastle","Westwyvern","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R037","type":"Connect","stops":["Leighton City","Edgemead","Fayemere","Westercoast","Milcastle","Westwyvern","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R038","type":"Connect","stops":["Leighton City","Edgemead","Fayemere","Westercoast","Milcastle","Westwyvern"]},
  {"routeId":"R039","type":"Connect","stops":["Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},
  {"routeId":"R040","type":"Connect","stops":["Edgemead","Fayemere","Westercoast","Milcastle","Westwyvern","Starrylock","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R041","type":"Connect","stops":["Leighton West","Edgemead"]},
  {"routeId":"R042","type":"Connect","stops":["Leighton West","Edgemead","Fayemere","Westercoast","Milcastle","Westwyvern","Starrylock","Northshore","Llyn-by-the-Sea"]},
  {"routeId":"R043","type":"Connect","stops":["Leighton West","Leighton City"]},
  {"routeId":"R044","type":"Connect","stops":["Benton","Benton Bridge","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City","Leighton West"]},
  {"routeId":"R045","type":"Connect","stops":["Stepford Victoria", "Stepford Central","Stepford East","St helen's Bridge","Bodin","Coxly","Benton","Hampton Hargate","Upper Staploe","Water Newton","Rocket Parade","Leighton Stepford Road","Leighton City"]},
  {
    "routeId": "R046",
    "type": "Connect",
    "stops": [
      "Stepford Victoria",
      "City Hospital",
      "Stepford Central",
      "Stepford East",
      "St Helens Bridge",
      "Bodin",
      "Coxly",
      "Benton",
      "Benton Bridge",
      "Stepford Airport Parkway",
      "Stepford Airport Central",
      "Airport Terminal 2"
    ]
  },
  {
    "routeId": "R047",
    "type": "Metro",
    "stops": [
      "St Helens Bridge",
      "Angel Pass",
      "Bodin",
      "Coxly",
      "Benton",
      "Port Benton"
    ]
  },
  {
    "routeId": "R048",
    "type": "Connect",
    "stops": [
      "St Helens Bridge",
      "Bodin",
      "Coxly",
      "Benton",
      "Benton Bridge",
      "Stepford Airport Parkway",
      "Stepford Airport Central",
      "Airport Terminal 2"
    ]
  },
  {
    "routeId": "R049",
    "type": "Connect",
    "stops": [
      "Rayleigh Bay",
      "Canalea Bridge",
      "Aslockby",
      "Edgemead"
    ]
  },
  {
    "routeId": "R050",
    "type": "Connect",
    "stops": [
      "Rayleigh Bay",
      "Rayleigh Bay",
      "Canalea Bridge",
      "Aslockby",
      "Edgemead",
      "Fayemere",
      "Westercoast",
      "Westwyvern",
      "Starrylock",
      "Northshore",
      "Llyn-by-the-Sea"
    ]
  },
  {
    "routeId": "R051",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "Stepford Airport Central"
    ]
  },
  {
    "routeId": "R052",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "Benton",
      "Stepford Airport Central",
      "Terminal 1 (only to T2)",
      "Airport Terminal 2"
    ]
  },
  {
    "routeId": "R053",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "Stepford East",
      "Elsemere Junction",
      "Airport Central",
      "Airport Airport Terminal 2"
    ]
  },
  {
    "routeId": "R054",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "St Helens Bridge",
      "Berrily (only to Airport)",
      "Stepford Airport Parkway",
      "Stepford Airport Central"
    ]
  },
  {
    "routeId": "R055",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "Stepford East",
      "Stepford Airport Parkway",
      "Stepford Airport Central",
      "Airport Terminal 2",
      "Airport Terminal 3"
    ]
  },
  {
    "routeId": "R056",
    "type": "Airlink",
    "stops": [
      "Stepford Airport Central",
      "Stepford Airport Parkway",
      "Leighton Stepford Road"
    ]
  },
  {
    "routeId": "R057",
    "type": "Airlink",
    "stops": [
      "Stepford Airport Central",
      "Water Newton",
      "Leighton Stepford Road"
    ]
  },
  {
    "routeId": "R058",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "St Helen's Bridge",
      "Morganstown",
      "Airport Central",
      "Terminal 1 (only to T2)",
      "Terminal 3 (Terminus)",
      "Terminal 2 (only to SC)"
    ]
  },
  {
    "routeId": "R059",
    "type": "Airlink",
    "stops": [
      "Stepford Central",
      "St Helen's Bridge",
      "Stepford Airport Parkway",
      "Stepford Airport Central",
      "Terminal 2"
    ]
  },
{"routeId":"R060","type":"Airlink","stops":["Stepford Airport Parkway","Airport Central","Airport Terminal 1","Terminal 2"]},
{"routeId":"R075","type":"Express","stops":["Stepford Central","Benton"]},
{"routeId":"R076","type":"Express","stops":["Leighton City","Leighton Stepford Road","Benton","St Helen's Bridge","Stepford Central"]},
{"routeId":"R077","type":"Express","stops":["Stepford Central","St Helen's Bridge","Benton","Leighton Stepford Road","Leighton City","Edgemead","Westwyvern","Northshore","Llyn-by-the-Sea"]},
{"routeId":"R078","type":"Express","stops":["Stepford Central","Benton","Leighton Stepford Road","Leighton City","Westwyvern","Llyn-by-the-Sea"]},
{"routeId":"R079","type":"Express","stops":["Stepford Central","St Helen's Bridge","Benton"]},
{"routeId":"R080","type":"Express","stops":["Stepford Central","St Helen's Bridge","Morganstown","Leighton Stepford Road","Leighton City","Westwyvern","Northshore","Llyn-by-the-Sea"]},
{"routeId":"R081","type":"Express","stops":["Stepford Central","Leighton City","Llyn-by-the-Sea"]},
{"routeId":"R082","type":"Express","stops":["Stepford Central","Elsemere Junction","Morganstown","Leighton Stepford Road","Leighton City","Edgemead","Westwyvern"]},
{"routeId":"R083","type":"Express","stops":["Newry","Benton","Morganstown","Leighton Stepford Road","Leighton City","Westwyvern","Northshore","Llyn-by-the-Sea"]},
{"routeId":"R084","type":"Express","stops":["Newry","Benton","Morganstown","Leighton Stepford Road","Leighton City","Westwyvern","Llyn-by-the-Sea"]},
{"routeId":"R085","type":"Express","stops":["Benton","Morganstown","Leighton Stepford Road","Leighton City","Northshore","Llyn-by-the-Sea"]},
{"routeId":"R086","type":"Express","stops":["Newry","Eden Quay","Benton","Leighton Stepford Road","Leighton City"]},
{"routeId":"R087","type":"Express","stops":["Rayleigh Bay","Edgemead","Westwyvern","Northshore","Llyn-by-the-Sea"]},
{"routeId":"R088","type":"Express","stops":["Stepford Central","St Helen's Bridge","Benton","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Llyn-by-the-Sea"]},
{"routeId":"R100","type":"Connect","stops":["Rayleigh Bay","Canalea Bridge","Edgemead","Leighton West"]},
{"routeId":"R101","type":"Connect","stops":["Rayleigh Bay","Canalea Bridge","Edgemead","Leighton City"]},
{"routeId":"R102","type":"Connect","stops":["Rayleigh Bay","Canalea Bridge","Edgemead","Fayemere","Milcastle Racecourse","Milcastle","Westwyvern"]},
{"routeId":"R103","type":"Connect","stops":["Willowfield","Beechley","Stepford Central","Stepford East","Stepford United FC","Woodhead Lane","Houghton Rake","Whitefield"]},
{"routeId":"R120","type":"Waterline","stops":["Newry Harbour","Newry","Eden Quay","Faraday Road","West Benton","Benton","Port Benton","Morganstown Docks","Morganstown"]},
{"routeId":"R130","type":"Metro","stops":["Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily","East Berrily","Beaulieu Park","Morganstown"]},
{"routeId":"R131","type":"Metro","stops":["Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Berrily","East Berrily","Beaulieu Park","Morganstown"]},
{"routeId":"R132","type":"Metro","stops":["Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","Angel Pass","Bodin","Coxly Newtown","Barton","Elsemere Junction","Elsemere Pound","New Harrow"]},
{"routeId":"R133","type":"Metro","stops":["Willowfield","Hedmon Park","Beechley","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","Angel Pass","Bodin","Coxly Newtown","Barton","Elsemere Junction","Elsemere Pound","New Harrow"]},
{"routeId":"R134","type":"Metro","stops":["Saint Helen's Bridge","Angel Pass","Bodin","Coxly Newtown","Barton","Elsemere Junction","Elsemere Pound","New Harrow"]},
{"routeId":"R135","type":"Metro","stops":["Beechley","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Barton","Coxly Newtown","Bodin","Angel Pass"]},
{"routeId":"R136","type":"Metro","stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","New Harrow","Elsemere Pound","Elsemere Junction","Barton","Coxly Newtown","Bodin","Angel Pass"]},
{"routeId":"R137","type":"Metro","stops":["Stepford Victoria","Financial Quarter","City Hospital","Stepford Central","Four Ways","Stepford East","Stepford High Street","Saint Helen's Bridge","Angel Pass","Bodin","Coxly","Benton","Port Benton","Morganstown Docks","Morganstown"]},
                
];
const stopGraph = {};
  
routes.forEach(route => {
  const stops = route.stops;
  for (let i = 0; i < stops.length - 1; i++) {
    const from = stops[i], to = stops[i + 1];

    if (!stopGraph[from]) stopGraph[from] = [];
    stopGraph[from].push({ stop: to, route });

    // Graph orienté (on va dans le bon sens)
  }
});

// Créer la liste des arrêts uniques
const allStops = Array.from(new Set(routes.flatMap(r => r.stops))).sort();

const populateSelect = (id) => {
  const select = document.getElementById(id);
  allStops.forEach(stop => {
    const option = document.createElement("option");
    option.value = stop;
    option.textContent = stop;
    select.appendChild(option);
  });
};

populateSelect("start");
populateSelect("end");

// Recherche avec DFS jusqu'à 4 correspondances
function findPaths(from, to) {
  const maxTransfers = 4;
  const results = [];

  function dfs(currentStop, target, path, visitedStops, usedRoutes, depth) {
    if (depth > maxTransfers + 1) return;

    if (currentStop === target) {
      results.push([...path]);
      return;
    }

    const neighbors = stopGraph[currentStop] || [];
    for (const neighbor of neighbors) {
      const { stop: nextStop, route } = neighbor;
      const routeId = route.routeId;

      if (visitedStops.has(nextStop)) continue;

const lastRoute = path.length && path[path.length - 1].route ? path[path.length - 1].route.routeId : null;
const routeChanged = routeId !== lastRoute;


      // Limiter les changements de route (max 4 correspondances)
      const routeChanges = usedRoutes.length + (routeChanged ? 1 : 0);
      if (routeChanges > maxTransfers + 1) continue;

      visitedStops.add(nextStop);
      path.push({ stop: nextStop, route });

      if (routeChanged) usedRoutes.push(routeId);
      dfs(nextStop, target, path, visitedStops, usedRoutes, depth + 1);
      if (routeChanged) usedRoutes.pop();

      path.pop();
      visitedStops.delete(nextStop);
    }
  }

  dfs(from, to, [{ stop: from, route: null }], new Set([from]), [], 0);
  return results;
}

// Afficher résultats
function displayResults(paths) {
  const resultsEl = document.getElementById("results");
  resultsEl.innerHTML = "";

  if (paths.length === 0) {
    resultsEl.innerHTML = "<li>Aucun itinéraire trouvé.</li>";
    return;
  }

  // Trier par longueur de trajet
  paths.sort((a, b) => a.length - b.length);

  const topPaths = paths.slice(0, 3);
  for (const path of topPaths) {
    const li = document.createElement("li");
    let html = "";

    if (Array.isArray(stops) && stops.length > 1) {
  for (let i = 0; i < stops.length - 1; i++) {
    const from = stops[i], to = stops[i + 1];
    // ton code ici...
  }
}


  if (!stopGraph[from]) stopGraph[from] = [];
  if (!stopGraph[to]) stopGraph[to] = [];

  stopGraph[from].push({ stop: to, route }); // sens normal
  stopGraph[to].push({ stop: from, route }); // sens inverse
}


      if (i === 0 || i === path.length - 1) {
        // Départ ou arrivée
        html += `<span>${stop}</span>`;
      } else {
        // Intermédiaire
        html += ` → <span class="intermediate">${stop}</span>`;
      }

      // Afficher la ligne si elle change
      if (isNewRoute) {
        html += ` <span style="color: gray">[${route.routeId}]</span>`;
      }
    }
  }
 li.innerHTML = html;
    resultsEl.appendChild(li);
// Événement
document.getElementById("searchBtn").addEventListener("click", () => {
  const from = document.getElementById("start").value;
  const to = document.getElementById("end").value;
  const resultsEl = document.getElementById("results");

  if (!from || !to) {
    resultsEl.innerHTML = "<li>Choisissez un départ et une arrivée.</li>";
    return;
  }
  if (from === to) {
    resultsEl.innerHTML = "<li>Départ et arrivée doivent être différents.</li>";
    return;
  }

  resultsEl.innerHTML = "<li>Recherche...</li>";
  setTimeout(() => {
    const paths = findPaths(from, to);
    displayResults(paths);
  }, 10);
});
</script>

</body>
</html>
