<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Itinéraire Express & Airlink</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      color: #333;
      padding: 20px;
    }

    h1 {
      color: #444;
    }

    select, button {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      max-width: 400px;
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      background-color: #fff;
      border-left: 5px solid #ccc;
      border-radius: 5px;
    }

    .step {
      margin-bottom: 12px;
    }

    .express {
      border-left-color: #cc33cc;
    }

    .airlink {
      border-left-color: #ff9900;
    }

    .operator-express {
      color: #cc33cc;
      font-weight: bold;
    }

    .operator-airlink {
      color: #ff9900;
      font-weight: bold;
    }

    .common {
      color: #000;
    }

    .intermediate {
      font-style: italic;
      font-size: 0.95em;
    }
  </style>
</head>
<body>
  <h1>Calculateur d'itinéraire – Stepford Express & Airlink</h1>

  <label for="depart">Gare de départ :</label>
  <select id="depart"></select>

  <label for="arrivee">Gare d’arrivée :</label>
  <select id="arrivee"></select>

  <button onclick="calculerItineraire()">Calculer</button>

  <div id="resultats"></div>

  <script>
    const lignes = [
      {
        nom: "Express – Lyn via Morganstown",
        operateur: "express",
        gares: ["Stepford Central", "St Helens Bridge", "Elsemere Junction", "Morganstown", "Leighton Stepford Road", "Leighton City", "Edgemead", "Westercoast", "Westwyvern", "Northshore", "Llyn-by-the-Sea"]
      },
      {
        nom: "Express – Lyn via Benton",
        operateur: "express",
        gares: ["Llyn-by-the-Sea", "Northshore", "Westwyvern", "Westercoast", "Edgemead", "Leighton City", "Leighton Stepford Road", "Benton", "St Helens Bridge", "Stepford Central"]
      },
      {
        nom: "Airlink 1",
        operateur: "airlink",
        gares: ["Stepford Central", "Stepford Airport Central"]
      },
      {
        nom: "Airlink 2",
        operateur: "airlink",
        gares: ["Stepford Central", "Stepford Airport Central", "Airport Terminal 1", "Airport Terminal 2"]
      },
      {
        nom: "Airlink 3",
        operateur: "airlink",
        gares: ["Stepford Central", "Stepford East", "Elsemere Junction", "Morganstown", "Stepford Airport Central", "Airport Terminal 1", "Airport Terminal 2"]
      },
      {
        nom: "Airlink 4",
        operateur: "airlink",
        gares: ["Stepford Central", "St Helens Bridge", "Berrily", "Stepford Airport Parkway", "Stepford Airport Central"]
      },
      {
        nom: "Airlink 5",
        operateur: "airlink",
        gares: ["Stepford Central", "Stepford East", "Stepford Airport Parkway", "Stepford Airport Central"]
      },
      {
        nom: "Airlink 6",
        operateur: "airlink",
        gares: ["Stepford Airport Central", "Stepford Airport Parkway", "Leighton Stepford Road"]
      },
      {
        nom: "Airlink 7",
        operateur: "airlink",
        gares: ["Airport Terminal 3", "Airport Terminal 2", "Stepford Airport Central", "Water Newton", "Leighton Stepford Road"]
      },
      {
        nom: "Airlink 8",
        operateur: "airlink",
        gares: ["Stepford Central", "St Helens Bridge", "Morganstown", "Stepford Airport Central", "Airport Terminal 1", "Airport Terminal 3"]
      },
      {
        nom: "Airlink 9",
        operateur: "airlink",
        gares: ["Stepford Central", "St Helens Bridge", "Elsemere Junction", "Stepford Airport Parkway", "Stepford Airport Central", "Airport Terminal 2"]
      }
    ];

    const toutesGares = Array.from(new Set(lignes.flatMap(l => l.gares))).sort();

    const selectDepart = document.getElementById('depart');
    const selectArrivee = document.getElementById('arrivee');
    const resultatsDiv = document.getElementById('resultats');

    toutesGares.forEach(gare => {
      const option1 = new Option(gare, gare);
      const option2 = new Option(gare, gare);
      selectDepart.add(option1);
      selectArrivee.add(option2);
    });

    function calculerItineraire() {
      const depart = selectDepart.value;
      const arrivee = selectArrivee.value;
      resultatsDiv.innerHTML = "";

      if (depart === arrivee) {
        resultatsDiv.innerHTML = "<p>Départ et arrivée identiques.</p>";
        return;
      }

      const itinerairePossibles = [];

      for (const ligne of lignes) {
        const idxDep = ligne.gares.indexOf(depart);
        const idxArr = ligne.gares.indexOf(arrivee);

        if (idxDep !== -1 && idxArr !== -1 && idxDep < idxArr) {
          itinerairePossibles.push({
            ligne,
            itineraire: ligne.gares.slice(idxDep, idxArr + 1),
            correspondance: false
          });
        }
      }

      // Tentatives avec correspondance si aucun direct trouvé
      if (itinerairePossibles.length === 0) {
        for (const ligne1 of lignes) {
          const idxDep = ligne1.gares.indexOf(depart);
          if (idxDep === -1) continue;

          for (const ligne2 of lignes) {
            if (ligne1 === ligne2) continue;
            const idxArr = ligne2.gares.indexOf(arrivee);
            if (idxArr === -1) continue;

            const correspondance = ligne1.gares.find(g =>
              ligne2.gares.includes(g) &&
              ligne1.gares.indexOf(g) > idxDep &&
              ligne2.gares.indexOf(g) < idxArr
            );

            if (correspondance) {
              const idx1 = ligne1.gares.indexOf(correspondance);
              const idx2 = ligne2.gares.indexOf(correspondance);
              itinerairePossibles.push({
                ligne: [ligne1, ligne2],
                correspondance,
                itineraire: [
                  ...ligne1.gares.slice(idxDep, idx1 + 1),
                  ...ligne2.gares.slice(idx2 + 1, idxArr + 1)
                ],
              });
            }
          }
        }
      }

      if (itinerairePossibles.length === 0) {
        resultatsDiv.innerHTML = "<p>Aucun itinéraire trouvé.</p>";
        return;
      }

      const meilleurs = itinerairePossibles.slice(0, 3);

      for (const item of meilleurs) {
        const container = document.createElement("div");
        container.className = `result ${Array.isArray(item.ligne) ? item.ligne[0].operateur : item.ligne.operateur}`;

        const nomLigne = Array.isArray(item.ligne) ? `${item.ligne[0].nom} + ${item.ligne[1].nom}` : item.ligne.nom;
        const operateur = Array.isArray(item.ligne) ? item.ligne[0].operateur : item.ligne.operateur;

        container.innerHTML = `<div class="step"><span class="operator-${operateur}">${nomLigne}</span></div>`;

        item.itineraire.forEach((gare, i, arr) => {
          const estCorrespondance = gare === item.correspondance;
          const estArrivee = gare === arrivee;
          const estDepart = gare === depart;
          const estIntermediaire = !estCorrespondance && !estArrivee && !estDepart;

          const ligne = document.createElement("div");
          ligne.className = "step";

          if (estCorrespondance) {
            ligne.innerHTML = `<b>→ Changer à ${gare}</b>`;
          } else if (estArrivee) {
            ligne.innerHTML = `<b>→ Arrivée à ${gare}</b>`;
          } else if (estDepart) {
            ligne.innerHTML = `Départ : ${gare}`;
          } else if (estIntermediaire) {
            ligne.innerHTML = `<span class="intermediate">${gare}</span>`;
          }

          container.appendChild(ligne);
        });

        resultatsDiv.appendChild(container);
      }
    }
  </script>
</body>
</html>
