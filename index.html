<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Itinéraire Stepford Express & Airlink</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f8f8f8; color: #333; padding: 20px; }
    h1 { color: #444; }
    select, button { padding: 10px; margin: 10px 0; width: 100%; max-width: 400px; }
    .result { margin-top: 30px; padding: 20px; background: #fff; border-left: 5px solid #ccc; border-radius: 5px; }
    .step { margin-bottom: 12px; }
    .express { border-left-color: #cc33cc; }
    .airlink { border-left-color: #ff9900; }
    .operator-express { color: #cc33cc; font-weight: bold; }
    .operator-airlink { color: #ff9900; font-weight: bold; }
    .common { color: #000; }
    .intermediate { font-style: italic; font-size: 0.95em; }
    .correspondance { font-weight: bold; color: #000; }
  </style>
</head>
<body>
  <h1>Calculateur d'itinéraire – Stepford Express & Airlink</h1>

  <label for="depart">Gare de départ :</label>
  <select id="depart"></select>

  <label for="arrivee">Gare d’arrivée :</label>
  <select id="arrivee"></select>

  <button onclick="calculerItineraire()">Calculer</button>

  <div id="resultats"></div>

  <script>
    const lignes = [
      { nom: "Express – Lyn via Morganstown", operateur: "express", gares: ["Stepford Central","St Helens Bridge","Elsemere Junction","Morganstown","Leighton Stepford Road","Leighton City","Edgemead","Westercoast","Westwyvern","Northshore","Llyn-by-the-Sea"] },
      { nom: "Express – Lyn via Benton", operateur: "express", gares: ["Llyn-by-the-Sea","Northshore","Westwyvern","Westercoast","Edgemead","Leighton City","Leighton Stepford Road","Benton","St Helens Bridge","Stepford Central"] },
      { nom: "Express – Rayleigh Bay", operateur: "express", gares: ["Llyn-by-the-Sea","Northshore","Westwyvern","Edgemead","Rayleigh Bay"] },
      { nom: "Express – Newry 1", operateur: "express", gares: ["Leighton City","Leighton Stepford Road","Benton","Eden Quay","Newry"] },
      { nom: "Express – Newry 2", operateur: "express", gares: ["Llyn-by-the-Sea","Westwyvern","Leighton City","Leighton Stepford Road","Benton","Newry","Newry Harbour"] },
      { nom: "Express – Newry 3", operateur: "express", gares: ["Llyn-by-the-Sea","Northshore","Westercoast","Leighton City","Leighton Stepford Road","Morganstown","Benton","Newry"] },
      { nom: "Airlink 1", operateur: "airlink", gares: ["Stepford Central","Stepford Airport Central"] },
      { nom: "Airlink 2", operateur: "airlink", gares: ["Stepford Central","Stepford Airport Central","Airport Terminal 1","Airport Terminal 2"] },
      { nom: "Airlink 3", operateur: "airlink", gares: ["Stepford Central","Stepford East","Elsemere Junction","Morganstown","Stepford Airport Central","Airport Terminal 1","Airport Terminal 2"] },
      { nom: "Airlink 4", operateur: "airlink", gares: ["Stepford Central","St Helens Bridge","Berrily","Stepford Airport Parkway","Stepford Airport Central"] },
      { nom: "Airlink 5", operateur: "airlink", gares: ["Stepford Central","Stepford East","Stepford Airport Parkway","Stepford Airport Central"] },
      { nom: "Airlink 6", operateur: "airlink", gares: ["Stepford Airport Central","Stepford Airport Parkway","Leighton Stepford Road"] },
      { nom: "Airlink 7", operateur: "airlink", gares: ["Airport Terminal 3","Airport Terminal 2","Stepford Airport Central","Water Newton","Leighton Stepford Road"] },
      { nom: "Airlink 8", operateur: "airlink", gares: ["Stepford Central","St Helens Bridge","Morganstown","Stepford Airport Central","Airport Terminal 1","Airport Terminal 3"] },
      { nom: "Airlink 9", operateur: "airlink", gares: ["Stepford Central","St Helens Bridge","Elsemere Junction","Stepford Airport Parkway","Stepford Airport Central","Airport Terminal 2"] }
    ];

    const toutesGares = Array.from(new Set(lignes.flatMap(l => l.gares))).sort();
    const departSelect = document.getElementById('depart');
    const arriveeSelect = document.getElementById('arrivee');
    const resultatsDiv = document.getElementById('resultats');

    toutesGares.forEach(gare => {
      departSelect.add(new Option(gare, gare));
      arriveeSelect.add(new Option(gare, gare));
    });

    function calculerItineraire() {
      const depart = departSelect.value;
      const arrivee = arriveeSelect.value;
      resultatsDiv.innerHTML = '';

      if (!depart || !arrivee) return;
      if (depart === arrivee) {
        resultatsDiv.innerHTML = '<p>Départ et arrivée identiques.</p>';
        return;
      }

      let options = [];

      // Direct
      lignes.forEach(ligne => {
        const i0 = ligne.gares.indexOf(depart);
        const i1 = ligne.gares.indexOf(arrivee);
        if (i0 !== -1 && i1 !== -1 && i0 < i1) {
          options.push({
            lignes: [ligne],
            chemin: ligne.gares.slice(i0, i1 + 1)
          });
        }
      });

      // Avec une correspondance
      if (options.length === 0) {
        lignes.forEach(l1 => {
          const i0 = l1.gares.indexOf(depart);
          if (i0 === -1) return;
          lignes.forEach(l2 => {
            if (l1 === l2) return;
            const iF = l2.gares.indexOf(arrivee);
            if (iF === -1) return;
            // trouver gare commune après depart et avant arrivee
            l1.gares.slice(i0 + 1).forEach(g => {
              const iC2 = l2.gares.indexOf(g);
              if (iC2 > -1 && iC2 < iF) {
                const iC1 = l1.gares.indexOf(g);
                const chemin = l1.gares.slice(i0, iC1 + 1)
                  .concat(l2.gares.slice(iC2 + 1, iF + 1));
                options.push({ lignes: [l1, l2], chemin, correspondance: g });
              }
            });
          });
        });
      }

      // Tri et top3
      options.sort((a, b) => a.chemin.length - b.chemin.length);
      const uniques = [];
      for (let opt of options) {
        if (!uniques.some(u => JSON.stringify(u.chemin) === JSON.stringify(opt.chemin))) {
          uniques.push(opt);
        }
        if (uniques.length >= 3) break;
      }

      // Affichage
      uniques.forEach(opt => {
        const cont = document.createElement('div');
        cont.className = 'result ' + (opt.lignes[0].operateur);

        // Départ
        cont.innerHTML += `<div class="step common">Monter à ${depart}</div>`;
        // Affichage chemin
        opt.chemin.forEach((g, idx) => {
          if (idx === 0 || idx === opt.chemin.length - 1) return;
          if (opt.correspondance && g === opt.correspondance) {
            cont.innerHTML += `<div class="step correspondance">Changer de train à ${g}</div>`;
          } else {
            cont.innerHTML += `<div class="step intermediate">${g}</div>`;
          }
        });
        // Arrivée
        cont.innerHTML += `<div class="step common">Descendre à ${arrivee}</div>`;

        resultatsDiv.appendChild(cont);
      });
    }
  </script>
</body>
</html>
