<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Itinéraire Stepford Express - Top 3 rapides</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    color: #333;
    padding: 20px;
  }
  h1 {
    color: #C71585;
  }
  label, select, button {
    font-size: 16px;
    margin: 10px 0;
  }
  select, button {
    padding: 8px;
  }
  .route {
    border: 2px solid #C71585;
    background: #fff0f5;
    padding: 15px;
    margin-top: 20px;
    border-radius: 10px;
  }
  .stop-key {
    font-weight: bold;
    font-size: 16px;
  }
  .stop-transfer {
    font-weight: bold;
    font-size: 16px;
    color: #9b0068;
  }
  .stop-intermediate {
    font-style: italic;
    font-size: 12px;
    color: #555;
    margin-left: 20px;
  }
  .transfer {
    margin: 15px 0;
    padding: 10px;
    background: #ffe6f0;
    border: 1px solid #C71585;
    border-radius: 8px;
    font-weight: bold;
    color: #9b0068;
  }
  .option {
    margin-bottom: 30px;
  }
  hr {
    border: none;
    border-top: 1px solid #C71585;
    margin: 20px 0;
  }
</style>
</head>
<body>
<h1>Itinéraire Stepford Express</h1>
<label for="from">Départ :</label>
<select id="from"></select>
<br />
<label for="to">Arrivée :</label>
<select id="to"></select>
<br />
<button onclick="findRoute()">Trouver l'itinéraire</button>

<div id="result" class="route"></div>

<script>
  const stations = [
    "Stepford Central", "St Helens Bridge", "Benton", "Elsemere Junction", "Morganstown",
    "Leighton Stepford Road", "Leighton City", "Edgemead", "Westercoast", "Westwyvern",
    "Northshore", "Llyn-by-the-Sea", "Eden Quay", "Newry", "Newry Harbour", "Rayleigh Bay"
  ];

  const lines = {
    stepford_express_main: [
      "Stepford Central", "St Helens Bridge", "Benton", "Leighton Stepford Road", "Leighton City",
      "Edgemead", "Westercoast", "Westwyvern", "Northshore", "Llyn-by-the-Sea"
    ],
    stepford_express_morganstown: [
      "Stepford Central", "St Helens Bridge", "Elsemere Junction", "Morganstown",
      "Leighton Stepford Road", "Leighton City", "Edgemead", "Westercoast",
      "Westwyvern", "Northshore", "Llyn-by-the-Sea"
    ],
    stepford_express_rayleigh_bay: [
      "Llyn-by-the-Sea", "Northshore", "Westwyvern", "Edgemead", "Rayleigh Bay"
    ],
    stepford_express_newry1: [
      "Leighton City", "Leighton Stepford Road", "Benton", "Eden Quay", "Newry"
    ],
    stepford_express_newry2: [
      "Llyn-by-the-Sea", "Westwyvern", "Leighton City", "Leighton Stepford Road", "Benton", "Newry", "Newry Harbour"
    ],
    stepford_express_newry3: [
      "Llyn-by-the-Sea", "Northshore", "Westercoast", "Leighton City",
      "Leighton Stepford Road", "Morganstown", "Benton", "Newry"
    ]
  };

  const fromSelect = document.getElementById("from");
  const toSelect = document.getElementById("to");

  stations.forEach(station => {
    const optFrom = document.createElement("option");
    optFrom.value = station;
    optFrom.textContent = station;
    fromSelect.appendChild(optFrom);

    const optTo = document.createElement("option");
    optTo.value = station;
    optTo.textContent = station;
    toSelect.appendChild(optTo);
  });

  function getPath(lineStops, start, end) {
    const startIndex = lineStops.indexOf(start);
    const endIndex = lineStops.indexOf(end);
    if (startIndex === -1 || endIndex === -1) return null;
    if (startIndex === endIndex) return null;
    return startIndex < endIndex ?
      lineStops.slice(startIndex, endIndex + 1) :
      lineStops.slice(endIndex, startIndex + 1).reverse();
  }

  function displaySegment(segment, keyStations) {
    let html = "";
    segment.forEach(station => {
      if (keyStations.includes(station)) {
        const cls = (keyStations.length > 2 && station === keyStations[1]) ? "stop-transfer" : "stop-key";
        html += `<div class="${cls}">→ ${station}</div>`;
      } else {
        html += `<div class="stop-intermediate">→ ${station}</div>`;
      }
    });
    return html;
  }

  function findRoute() {
    const from = fromSelect.value;
    const to = toSelect.value;
    let output = "";

    if (from === to) {
      output = "Le départ et l'arrivée sont identiques.";
      document.getElementById("result").innerHTML = output;
      return;
    }

    // Tableau d'options de trajets
    let routeOptions = [];

    // Chercher trajet direct
    for (const [lineName, stops] of Object.entries(lines)) {
      const directPath = getPath(stops, from, to);
      if (directPath) {
        routeOptions.push({
          type: "direct",
          lineName,
          segment1: directPath,
          totalLength: directPath.length
        });
      }
    }

    // Chercher correspondances (1 changement)
    const linesWithFrom = [];
    const linesWithTo = [];

    for (const [lineName, stops] of Object.entries(lines)) {
      if (stops.includes(from)) linesWithFrom.push({ lineName, stops });
      if (stops.includes(to)) linesWithTo.push({ lineName, stops });
    }

    for (const fromLine of linesWithFrom) {
      for (const toLine of linesWithTo) {
        const commonStations = fromLine.stops.filter(st => toLine.stops.includes(st));
        for (const transferStation of commonStations) {
          if (transferStation !== from && transferStation !== to) {
            const segment1 = getPath(fromLine.stops, from, transferStation);
            const segment2 = getPath(toLine.stops, transferStation, to);
            if (segment1 && segment2) {
              routeOptions.push({
                type: "transfer",
                fromLine: fromLine.lineName,
                toLine: toLine.lineName,
                transferStation,
                segment1,
                segment2,
                totalLength: segment1.length + segment2.length
              });
            }
          }
        }
      }
    }

    if (routeOptions.length === 0) {
      output = "Aucune liaison directe ou avec une correspondance simple trouvée. Essayez d'autres gares.";
      document.getElementById("result").innerHTML = output;
      return;
    }

    // Trier par longueur totale (nombre de gares) croissante
    routeOptions.sort((a, b) => a.totalLength - b.totalLength);

    // Garder seulement les 3 premières options
    routeOptions = routeOptions.slice(0, 3);

    output += `<strong>Les 3 itinéraires les plus rapides :</strong><br><br>`;

    routeOptions.forEach((route, i) => {
      output += `<div class="option">`;
      output += `<div><em>Option ${i + 1}</em></div>`;

      if (route.type === "direct") {
        output += `<div>Itinéraire direct Stepford Express (${route.lineName.replace('stepford_express_', '').replaceAll('_', ' ')}) :</div>`;
        output += displaySegment(route.segment1, [from, to]);
      } else if (route.type === "transfer") {
        output += `<div>Départ ligne <em>${route.fromLine.replace('stepford_express_', '').replaceAll('_', ' ')}</em> :</div>`;
        output += displaySegment(route.segment1, [from, route.transferStation, route
